<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coze å·¥ä½œæµä¸“ç”¨è°ƒç”¨è¡¨å•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            padding-top: 50px;
            color: #333;
        }
        .card {
            background: white;
            width: 100%;
            max-width: 700px;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
        }
        h2 { margin-top: 0; color: #165DFF; margin-bottom: 20px; }
        .description { color: #666; font-size: 14px; margin-bottom: 30px; }
        
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; }
        
        /* è¾“å…¥æ¡†æ ·å¼ */
        input[type="text"], input[type="password"], textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #e5e6eb;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        textarea { resize: vertical; min-height: 80px; font-family: monospace; }
        input:focus, textarea:focus { border-color: #165DFF; outline: none; }

        /* å¿…å¡«é¡¹æ ‡è®° */
        .required::after { content: "*"; color: red; margin-left: 4px; }

        /* æŒ‰é’®æ ·å¼ */
        button {
            background-color: #165DFF;
            color: white;
            border: none;
            width: 100%;
            padding: 14px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover { background-color: #0e42d2; }
        button:disabled { background-color: #aebdff; cursor: not-allowed; }

        /* ç»“æœå±•ç¤ºåŒº */
        #result-area {
            margin-top: 30px;
            display: none; /* é»˜è®¤éšè— */
        }
        pre {
            background: #232323;
            color: #83ff83;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .status-tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸš€ è°ƒç”¨ Coze å·¥ä½œæµ</h2>
    <p class="description">
        Workflow ID: 7603017775339487267<br>
        è¯·è¾“å…¥å·¥ä½œæµæ‰€éœ€çš„ Cookie å’Œ Keywords å‚æ•°ã€‚
    </p>

    <!-- é…ç½®éƒ¨åˆ† -->
    <div class="form-group">
        <label class="required" for="token">Coze API Token (PAT)</label>
        <input type="password" id="token" placeholder="ç²˜è´´ä½ çš„ Access Token (ä¾‹å¦‚: pat_xxxx...)">
    </div>

    <hr style="border: 0; border-top: 1px solid #eee; margin: 25px 0;">

    <!-- å‚æ•°è¡¨å• -->
    <div class="form-group">
        <label class="required" for="cookie">Cookie (å­—ç¬¦ä¸²)</label>
        <textarea id="cookie" placeholder="åœ¨æ­¤å¤„ç²˜è´´å®Œæ•´çš„ Cookie å­—ç¬¦ä¸²..." rows="4"></textarea>
    </div>

    <div class="form-group">
        <label class="required" for="keywords">Keywords (å…³é”®è¯)</label>
        <input type="text" id="keywords" placeholder="ä¾‹å¦‚ï¼šäººå·¥æ™ºèƒ½, Pythonæ•™ç¨‹">
    </div>

    <button id="submitBtn" onclick="submitForm()">å¼€å§‹æ‰§è¡Œ</button>

    <!-- ç»“æœå±•ç¤º -->
    <div id="result-area">
        <div id="status-label" class="status-tag">æ‰§è¡Œç»“æœ</div>
        <pre id="output">ç­‰å¾…è¿”å›æ•°æ®...</pre>
    </div>
</div>

<script>
    const WORKFLOW_ID = "7603017775339487267";

    async function submitForm() {
        // 1. æ¸…æ´— Token
        let tokenRaw = document.getElementById('token').value;
        let token = tokenRaw.replace(/[^\x21-\x7E]/g, ''); 

        const cookieVal = document.getElementById('cookie').value; 
        const keywordsVal = document.getElementById('keywords').value.trim();
        
        const btn = document.getElementById('submitBtn');
        const output = document.getElementById('output');
        const statusLabel = document.getElementById('status-label');
        const resultArea = document.getElementById('result-area');

        if (!token) return alert("API Token ä¸èƒ½ä¸ºç©º");
        if (!cookieVal) return alert("Cookie ä¸èƒ½ä¸ºç©º");

        // 2. æ„é€ æ•°æ®
        const payload = {
            workflow_id: WORKFLOW_ID,
            parameters: {
                // è¯·ç¡®ä¿è¿™é‡Œçš„ key (cookie, keywords) ä¸å·¥ä½œæµã€å·²å‘å¸ƒç‰ˆæœ¬ã€‘çš„å¼€å§‹èŠ‚ç‚¹å˜é‡åå®Œå…¨ä¸€è‡´
                cookie: cookieVal,
                keywords: keywordsVal
            }
        };

        // ğŸ”´ è°ƒè¯•æ­¥éª¤ï¼šæ‰“å°å‘å‡ºçš„æ•°æ®
        // å¦‚æœè¿™é‡Œæ˜¾ç¤ºçš„ JSON å’Œä½ å·¥ä½œæµé‡Œçš„ä¸ä¸€æ ·ï¼Œé‚£å°±æ˜¯é—®é¢˜æ‰€åœ¨
        console.log("æ­£åœ¨å‘é€çš„æ•°æ®:", payload);

        btn.disabled = true;
        btn.innerText = "è¿è¡Œä¸­...";
        resultArea.style.display = "block";
        output.innerText = "æ­£åœ¨è¯·æ±‚...\n\nå‘é€çš„å‚æ•°å†…å®¹:\n" + JSON.stringify(payload.parameters, null, 2);
        statusLabel.innerText = "è¯·æ±‚ä¸­";
        statusLabel.style.backgroundColor = "#ffb400";

        try {
            const response = await fetch('https://api.coze.cn/v1/workflow/run', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            });

            const data = await response.json();
            
            if (data.code === 0) {
                statusLabel.innerText = "æ‰§è¡ŒæˆåŠŸ";
                statusLabel.style.backgroundColor = "#00b42a";
                let cleanData = data;
                try {
                    if (data.data && typeof data.data === 'string') {
                        cleanData.data = JSON.parse(data.data);
                    }
                } catch(e){}
                output.innerText = "âœ… æˆåŠŸè¿”å›:\n" + JSON.stringify(cleanData, null, 2);
            } else {
                // æ­¤æ—¶æ•è· API é€»è¾‘é”™è¯¯ (å¦‚ code 4000)
                statusLabel.innerText = "API æ‹’ç»";
                statusLabel.style.backgroundColor = "#ff7d00";
                output.innerText = "âš ï¸ API æŠ¥é”™ (Code " + data.code + "):\n" + data.msg + 
                "\n\nğŸ‘‰ æå¤§æ¦‚ç‡åŸå› ï¼šä½ ä¿®æ”¹äº† Start èŠ‚ç‚¹çš„å‚æ•°ï¼Œä½†æ²¡æœ‰ç‚¹å‡»å³ä¸Šè§’çš„ã€å‘å¸ƒã€‘æŒ‰é’®ã€‚\nAPI åªèƒ½è®¿é—®å·²å‘å¸ƒçš„ç‰ˆæœ¬ã€‚";
            }

        } catch (error) {
            console.error(error);
            statusLabel.innerText = "ç½‘ç»œ/ç³»ç»Ÿé”™è¯¯";
            statusLabel.style.backgroundColor = "#f53f3f";
            
            if (error.message.includes('Failed to fetch')) {
                output.innerText = "âŒ è·¨åŸŸ(CORS)é”™è¯¯ã€‚\nè¯·ç¡®ä¿å·²å¼€å¯ 'Allow CORS' æµè§ˆå™¨æ’ä»¶ã€‚";
            } else {
                output.innerText = "âŒ é”™è¯¯:\n" + error.message;
            }
        } finally {
            btn.disabled = false;
            btn.innerText = "å¼€å§‹æ‰§è¡Œ";
        }
    }
</script>

</body>
</html>